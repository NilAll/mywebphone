<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CloudOS - Nil All InfoTech</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        [x-cloak] { display: none !important; }
        body { background-color: #000; color: #fff; font-family: -apple-system, sans-serif; height: 100dvh; overflow: hidden; margin: 0; }
        .ios-blur { background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body x-data="cloudOS()" x-init="init()" class="flex flex-col h-full w-full">

    <div x-show="!isLoggedIn" class="fixed inset-0 z-[1000] bg-zinc-950 flex flex-col items-center justify-center p-6 text-center">
        <div class="w-20 h-20 bg-gradient-to-tr from-blue-600 to-indigo-500 rounded-3xl mb-6 flex items-center justify-center shrink-0 shadow-2xl">
            <i data-lucide="smartphone" class="w-10 h-10 text-white font-bold"></i>
        </div>
        <h1 class="text-3xl font-bold mb-1" x-text="authMode === 'login' ? 'CloudOS' : 'Nova Conta'"></h1>
        <p class="text-zinc-500 mb-8 text-sm font-medium">Nil All InfoTech - Virtual Mobile</p>
        
        <div class="w-full max-w-xs space-y-3">
            <template x-if="authMode === 'signup'">
                <input type="text" x-model="authField.fullName" placeholder="Nome Completo" class="w-full p-4 rounded-2xl bg-zinc-900 border border-zinc-800 outline-none text-white text-base focus:ring-2 focus:ring-blue-500">
            </template>
            
            <input type="email" x-model="authField.email" @keyup.enter="handleAuthAction" placeholder="E-mail" class="w-full p-4 rounded-2xl bg-zinc-900 border border-zinc-800 outline-none text-white text-base focus:ring-2 focus:ring-blue-500">
            <input type="password" x-model="authField.pass" @keyup.enter="handleAuthAction" placeholder="Senha" class="w-full p-4 rounded-2xl bg-zinc-900 border border-zinc-800 outline-none text-white text-base focus:ring-2 focus:ring-blue-500">
            
            <button @click="handleAuthAction" class="w-full py-4 bg-white text-black font-extrabold rounded-2xl active:scale-95 transition-all text-base uppercase shadow-lg">
                <span x-show="!loading" x-text="authMode === 'login' ? 'ENTRAR' : 'CADASTRAR'"></span>
                <span x-show="loading">Processando...</span>
            </button>
            
            <button @click="authMode = authMode === 'login' ? 'signup' : 'login'" class="w-full py-2 text-blue-400 text-sm font-medium">
                <span x-text="authMode === 'login' ? 'Não tem conta? Cadastre-se' : 'Já tem conta? Login'"></span>
            </button>
        </div>
    </div>

    <div class="flex-1 flex flex-col relative overflow-hidden" x-show="isLoggedIn" x-cloak>
        <div class="absolute inset-0 z-0">
            <img src="https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe" class="w-full h-full object-cover scale-110">
        </div>

        <header class="relative z-50 flex justify-between items-center px-6 pt-4 pb-2 text-[11px] font-bold drop-shadow-md">
            <span x-text="currentTime"></span>
            <button @click="showInfoModal = true" class="p-1.5 bg-black/20 rounded-full border border-white/10 active:scale-90 transition">
                <i data-lucide="info" class="w-4 h-4 text-zinc-300"></i>
            </button>
        </header>

        <main class="flex-1 relative z-10 grid grid-cols-4 gap-y-8 px-6 pt-10 justify-items-center content-start overflow-y-auto hide-scroll pb-32">
            <div @click="alert('Sistema de Mensagens conectando ao banco...')" class="flex flex-col items-center gap-1.5 cursor-pointer active:scale-90 transition">
                <div class="w-16 h-16 bg-green-500 rounded-[22%] flex items-center justify-center shadow-xl border border-white/10">
                    <i data-lucide="message-circle" class="w-10 h-10 fill-white/10"></i>
                </div>
                <span class="text-[11px] font-medium drop-shadow-md">Chat</span>
            </div>
        </main>

        <footer class="absolute bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-sm h-20 ios-blur rounded-[38px] flex items-center justify-around px-4 z-40 border border-white/10">
            <div @click="alert('Busca em breve!')" class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center shadow-lg active:scale-90 transition"><i data-lucide="search" class="w-7 h-7 text-blue-600"></i></div>
            <div @click="logout()" class="w-14 h-14 bg-rose-600 rounded-2xl flex items-center justify-center shadow-lg active:scale-90 transition"><i data-lucide="power" class="w-7 h-7 text-white font-bold"></i></div>
        </footer>

        <div x-show="showInfoModal" @click.self="showInfoModal = false" class="fixed inset-0 z-[800] flex items-center justify-center p-6 bg-black/60 backdrop-blur-sm">
            <div class="bg-zinc-900 w-full max-w-xs rounded-[35px] border border-white/10 shadow-2xl p-6 text-center overflow-hidden">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-3 font-bold text-xl uppercase" x-text="userEmail ? userEmail[0] : '?'"></div>
                <p class="font-bold text-lg" x-text="userFullName"></p>
                <p class="text-xs text-blue-400 mb-6 font-mono" x-text="userEmail"></p>
                <div class="space-y-2 mb-6">
                    <div class="flex justify-between text-[10px] uppercase font-bold text-zinc-500"><span>Sessão</span><span class="text-zinc-300">Expira 23:59</span></div>
                    <div class="flex justify-between text-[10px] uppercase font-bold text-zinc-500"><span>Status</span><span class="text-green-500">Conectado</span></div>
                </div>
                <button @click="showInfoModal = false" class="w-full py-3 bg-zinc-800 rounded-2xl font-bold text-sm active:bg-zinc-700 transition">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        const S_URL = 'https://lzdroenqflqmcxojlkap.supabase.co';
        const S_KEY = 'sb_publishable_6Uy3BYLO0Igiyz_Q8iQeNQ_TvIaLbri';
        const sb = supabase.createClient(S_URL, S_KEY);

        function cloudOS() {
            return {
                isLoggedIn: false,
                authMode: 'login',
                loading: false,
                currentTime: '',
                showInfoModal: false,
                userEmail: '',
                userFullName: '',
                authField: { email: '', pass: '', fullName: '' },

                async init() {
                    this.updateTime();
                    setInterval(() => this.updateTime(), 1000);
                    
                    try {
                        const { data: { session } } = await sb.auth.getSession();
                        if (session) {
                            const lastLogin = localStorage.getItem('c_last_login');
                            if (lastLogin === new Date().toDateString()) {
                                this.isLoggedIn = true;
                                this.userEmail = session.user.email;
                                this.userFullName = session.user.user_metadata.full_name || 'Usuário';
                            } else {
                                await this.logout();
                            }
                        }
                    } catch (e) {
                        console.error("Erro ao iniciar sessão:", e);
                    }
                    lucide.createIcons();
                },

                updateTime() {
                    const now = new Date();
                    this.currentTime = now.toLocaleTimeString('pt-br', { hour: '2-digit', minute: '2-digit' });
                },

                async handleAuthAction() {
                    if (this.loading) return;
                    this.loading = true;
                    try {
                        if (this.authMode === 'login') {
                            const { data, error } = await sb.auth.signInWithPassword({
                                email: this.authField.email,
                                password: this.authField.pass
                            });
                            if (error) throw error;
                            
                            localStorage.setItem('c_last_login', new Date().toDateString());
                            location.reload();
                        } else {
                            if (!this.authField.fullName) throw new Error("Preencha o nome completo!");
                            
                            const { data, error } = await sb.auth.signUp({
                                email: this.authField.email,
                                password: this.authField.pass,
                                options: { data: { full_name: this.authField.fullName } }
                            });
                            if (error) throw error;
                            alert("Verifique seu e-mail para confirmar a conta!");
                        }
                    } catch (e) {
                        alert("Erro: " + e.message);
                    } finally {
                        this.loading = false;
                        lucide.createIcons();
                    }
                },

                async logout() {
                    await sb.auth.signOut();
                    localStorage.removeItem('c_last_login');
                    location.reload();
                }
            }
        }
    </script>
</body>
</html>